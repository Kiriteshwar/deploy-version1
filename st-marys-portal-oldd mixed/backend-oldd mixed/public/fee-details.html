<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fee Details - St. Mary's School</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f5f7fa;
        }
        header {
            background: #007bff;
            color: white;
            padding: 1.2rem 0 1.2rem 0;
            box-shadow: none;
            border: none;
            position: sticky;
            top: 0;
            z-index: 100;
            margin: 0;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        .header-left {
            flex: 1;
        }
        .header-title {
            flex: 2;
            text-align: center;
        }
        .header-title h1 {
            font-size: 1.7rem;
            font-weight: 700;
            margin: 0;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            letter-spacing: 1px;
        }
        .back-button {
            display: inline-flex;
            align-items: center;
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }
        .back-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            opacity: 1;
        }
        .back-button i {
            margin-right: 0.5rem;
        }
        .fee-container {
            max-width: 900px;
            margin: 40px auto 0 auto;
            padding: 0 0 30px 0;
            border-radius: 12px;
            background: none;
            box-shadow: none;
        }
        .dashboard-section {
            margin-bottom: 28px;
        }
        .dashboard-section h3 {
            color: #007BFF;
            margin-bottom: 15px;
            font-size: 1.15rem;
            font-weight: 700;
        }
        .dashboard-info {
            background-color: #fff;
            padding: 22px 28px;
            margin: 0 0 0 0;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px 0 rgba(0,0,0,0.04);
        }
        .dashboard-info p {
            margin: 8px 0;
            font-size: 1.08rem;
        }
        .dashboard-info strong {
            color: #222;
            font-weight: 600;
            min-width: 110px;
            display: inline-block;
        }
        .dashboard-info em {
            color: #888;
        }
        /* Improved fee structure table */
        #fee-structure-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 5px;
        }
        #fee-structure-table th, #fee-structure-table td {
            padding: 10px 14px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 1.08rem;
        }
        #fee-structure-table th {
            background: #f8f9fa;
            color: #007BFF;
            font-weight: 700;
            text-align: left;
        }
        #fee-structure-table td.label {
            color: #222;
            font-weight: 600;
        }
        #fee-structure-table td.value {
            color: #333;
        }
        #fee-structure-table tr:last-child td {
            font-weight: 700;
            color: #007BFF;
        }
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .payment-table th,
        .payment-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        .payment-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .payment-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .status-paid {
            background-color: #d4edda;
            color: #155724;
        }
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-overdue {
            background-color: #f8d7da;
            color: #721c24;
        }
        .dashboard-btn {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 20px;
            transition: background 0.2s;
        }
        .dashboard-btn:hover {
            background-color: #0056b3;
        }
        .receipt-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.4);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .receipt-modal-content {
            background: #fff;
            border-radius: 10px;
            padding: 30px 30px 20px 30px;
            max-width: 480px;
            width: 95vw;
            box-shadow: 0 4px 24px rgba(0,0,0,0.18);
            position: relative;
        }
        .close-receipt-modal {
            position: absolute;
            top: 12px;
            right: 18px;
            font-size: 1.5rem;
            color: #888;
            cursor: pointer;
        }
        .receipt-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .view-receipt-link {
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 5px 14px;
            font-size: 0.98em;
            margin: 0;
            cursor: pointer;
            display: inline-block;
            vertical-align: middle;
        }
        .download-btn {
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 5px 14px;
            font-size: 0.98em;
            margin: 0;
            cursor: pointer;
            display: inline-block;
            vertical-align: middle;
        }
        .download-btn:hover {
            background: #0056b3;
            color: #fff;
            box-shadow: 0 2px 8px rgba(0,123,255,0.15);
            transform: translateY(-1px) scale(1.03);
        }

        .view-receipt-link:hover {
            background: #0056b3;
            color: #fff;
            box-shadow: 0 2px 8px rgba(0,123,255,0.15);
            transform: translateY(-1px) scale(1.03);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-left">
                <a href="dashboard.html" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    Return to Dashboard
                </a>
            </div>
            <div class="header-title">
                <h1><i class="fa-solid fa-indian-rupee-sign"></i> Fee Details</h1>
            </div>
        </div>
    </header>
    <div class="fee-container">
        <h2>Fee Details</h2>
        <div id="error-message" class="error-message" style="display:none;"></div>
        <div class="dashboard-section">
            <h3>Student Information</h3>
            <div class="dashboard-info" id="student-info">
                <!-- Student info will be populated here -->
            </div>
        </div>
        <div id="fee-summary" class="dashboard-info" style="margin-bottom: 28px; margin-top: -10px;">
            <!-- Paid Amount, Balance Due, Due Date will be populated here -->
        </div>
        <div class="dashboard-section">
            <h3>Payment History</h3>
            <div class="dashboard-info">
                <table class="payment-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Payment Mode</th>
                            <th>Amount</th>
                            <th>Receipt</th>
                        </tr>
                    </thead>
                    <tbody id="payment-history">
                        <!-- Payment history will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- Receipt Modal -->
    <div id="receipt-modal" class="receipt-modal">
        <div class="receipt-modal-content" id="receipt-modal-content">
            <span class="close-receipt-modal" onclick="closeReceiptModal()">&times;</span>
            <div id="receipt-content"></div>
            <button class="download-btn" onclick="downloadReceiptPDF()">Download Receipt</button>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/fee-alert.js"></script>
    <script>
        // Add this at the top of your <script> block, after jsPDF is loaded
        // NOTE: You must place NotoSans-Regular.ttf in public/fonts/ and use the correct path below
        window.addEventListener('DOMContentLoaded', async () => {
            if (window.jspdf && window.jspdf.jsPDF) {
                const fontUrl = '/fonts/NotoSans-Regular.ttf';
                const fontName = 'NotoSans';
                const fontStyle = 'normal';
                const jsPDF = window.jspdf.jsPDF;
                const response = await fetch(fontUrl);
                const fontData = await response.arrayBuffer();
                jsPDF.API.events.push(['addFonts', function() {
                    this.addFileToVFS('NotoSans-Regular.ttf', btoa(String.fromCharCode.apply(null, new Uint8Array(fontData))));
                    this.addFont('NotoSans-Regular.ttf', fontName, fontStyle);
                }]);
            }
        });
        // Fetch and display fee details
        async function loadFeeDetails() {
            const errorDiv = document.getElementById('error-message');
            errorDiv.style.display = 'none';
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch('/api/fees', {
                    headers: {
                        'Authorization': token ? `Bearer ${token}` : '',
                        'Content-Type': 'application/json'
                    }
                });
                if (response.status === 401) {
                    errorDiv.textContent = 'You are not authorized. Please log in again.';
                    errorDiv.style.display = 'block';
                    document.getElementById('student-info').innerHTML = '';
                    document.getElementById('fee-summary').innerHTML = '';
                    document.getElementById('payment-history').innerHTML = '';
                    return;
                }
                if (!response.ok) {
                    throw new Error('Failed to fetch fee details');
                }
                const data = await response.json();
                console.log('Raw API Response:', data);
                console.log('Fee Structure:', data.feeStructure);
                console.log('Payments:', data.payments);

                // Display student info
                document.getElementById('student-info').innerHTML = `
                    <p><strong>Name:</strong> ${data.student.name}</p>
                    <p><strong>Class:</strong> ${data.student.class}-${data.student.section}</p>
                    <p><strong>Roll Number:</strong> ${data.student.rollNumber}</p>
                `;
                // Display payment history
                renderPaymentHistory(data.payments || []);

                // Only show total fee from fee structure and due date
                const totalFee = data.feeStructure ? data.feeStructure.totalFee : 0;
                const dueDate = data.feeStructure ? data.feeStructure.dueDate : null;
                const latestPayment = data.payments && data.payments[0];
                const status = latestPayment ? latestPayment.status : null;

                const summaryBox = document.createElement('div');
                summaryBox.style.display = 'flex';
                summaryBox.style.justifyContent = 'space-between';
                summaryBox.style.alignItems = 'center';
                summaryBox.style.background = '#f8f9fa';
                summaryBox.style.border = '1px solid #e0e0e0';
                summaryBox.style.borderRadius = '8px';
                summaryBox.style.padding = '14px 18px';
                summaryBox.style.marginTop = '14px';
                summaryBox.style.marginBottom = '0';
                summaryBox.innerHTML = `
                    <div><span style="color:#111;font-weight:700;">Total Fee:</span> <span style="color:#007bff;font-weight:700;">₹${totalFee}</span></div>
                    <div><span style="color:#111;font-weight:700;">Due Date:</span> <span style="color:#d9534f;font-weight:700;">${dueDate ? new Date(dueDate).toLocaleDateString() : '-'}</span></div>
                `;
                document.getElementById('fee-summary').innerHTML = '';
                document.getElementById('fee-summary').appendChild(summaryBox);
                 if (status === 'overdue') {
                    document.getElementById('fee-summary').innerHTML += `<div style="margin-top:16px;"><div style='background:#ffdddd;color:#a00;padding:18px 24px;font-size:1.25em;border-radius:8px;font-weight:bold;border:2px solid #f99;text-align:center;box-shadow:0 2px 8px #fbb;'>⚠️ Your fee is overdue! Please pay immediately.</div></div>`;
                }
            } catch (error) {
                errorDiv.textContent = 'Failed to load fee details. Please try again later.';
                errorDiv.style.display = 'block';
                document.getElementById('student-info').innerHTML = '';
                document.getElementById('fee-summary').innerHTML = '';
                document.getElementById('payment-history').innerHTML = '';
            }
        }
        function formatAmount(num) {
            if (num === null || num === undefined || isNaN(num)) {
                return '0';
            }
            return Number(num).toLocaleString('en-IN', { maximumFractionDigits: 2 });
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '-';
            const d = new Date(dateStr);
            return d.toLocaleDateString() + ' ' + d.toLocaleTimeString();
        }

        function getStudentInfoFromPage() {
            const infoDiv = document.getElementById('student-info');
            if (!infoDiv) return {};
            const name = infoDiv.querySelector('p:nth-child(1) strong') ? infoDiv.querySelector('p:nth-child(1)').textContent.replace('Name:', '').trim() : '';
            const classSection = infoDiv.querySelector('p:nth-child(2) strong') ? infoDiv.querySelector('p:nth-child(2)').textContent.replace('Class:', '').trim() : '';
            const rollNumber = infoDiv.querySelector('p:nth-child(3) strong') ? infoDiv.querySelector('p:nth-child(3)').textContent.replace('Roll Number:', '').trim() : '';
            let className = '', section = '';
            if (classSection.includes('-')) {
                [className, section] = classSection.split('-').map(s => s.trim());
            } else {
                className = classSection;
            }
            return { name, class: className, section, rollNumber };
        }

        function generateReceiptPDF(doc, pay, openInNewWindow = false) {
            try {
                const student = getStudentInfoFromPage();
                const docPDF = new window.jspdf.jsPDF();
                
                // Modern color scheme
                const primaryColor = [0, 123, 255]; // Blue
                const secondaryColor = [108, 117, 125]; // Gray
                const successColor = [40, 167, 69]; // Green
                const backgroundColor = [248, 249, 250]; // Light gray
                const borderColor = [220, 224, 229]; // Light border

                // Modern header background
                docPDF.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                docPDF.rect(0, 0, 210, 50, 'F');
                
                // White content area with shadow effect
                docPDF.setFillColor(255, 255, 255);
                docPDF.rect(10, 45, 190, 240, 'F');
                docPDF.setDrawColor(borderColor[0], borderColor[1], borderColor[2]);
                docPDF.setLineWidth(1);
                docPDF.rect(10, 45, 190, 240, 'S');

                // School Logo and Header
                try {
                    docPDF.addImage('images/logo.jpg', 'JPEG', 20, 8, 30, 30);
                } catch (logoError) {
                    console.warn('Logo not found, continuing without logo');
                }
                
                // School Name and Header Info
                docPDF.setFont('helvetica', 'bold');
                docPDF.setFontSize(24);
                docPDF.setTextColor(255, 255, 255);
                docPDF.text("St. Mary's High School", 55, 20);
                
                docPDF.setFont('helvetica', 'normal');
                docPDF.setFontSize(10);
                docPDF.text('Hasanparthy, Dist: Hanamkonda, Telangana - 506371', 55, 28);
                docPDF.text('Phone: +91-9999999999 | Email: infostmarysscl@gmail.com', 55, 35);

                // Receipt Title with background
                docPDF.setFillColor(successColor[0], successColor[1], successColor[2]);
                docPDF.roundedRect(15, 55, 180, 15, 3, 3, 'F');
                docPDF.setFont('helvetica', 'bold');
                docPDF.setFontSize(16);
                docPDF.setTextColor(255, 255, 255);
                docPDF.text('OFFICIAL FEE PAYMENT RECEIPT', 105, 65, { align: 'center' });

                // Receipt details box
                let y = 85;
                docPDF.setFillColor(backgroundColor[0], backgroundColor[1], backgroundColor[2]);
                docPDF.roundedRect(15, y - 5, 180, 20, 2, 2, 'F');
                
                docPDF.setFont('helvetica', 'bold');
                docPDF.setFontSize(11);
                docPDF.setTextColor(0, 0, 0);
                
                if (pay.receipt && pay.receipt.number) {
                    docPDF.text(`Receipt No: ${pay.receipt.number}`, 20, y + 3);
                }
                docPDF.text(`Date: ${formatDateTime(pay.paymentDate).split(' ')[0]}`, 130, y + 3);
                docPDF.text(`Time: ${formatDateTime(pay.paymentDate).split(' ')[1]}`, 130, y + 10);
                docPDF.text(`Academic Year: ${new Date().getFullYear()}-${new Date().getFullYear() + 1}`, 20, y + 10);

                // Student Information Section
                y = 115;
                docPDF.setFont('helvetica', 'bold');
                docPDF.setFontSize(14);
                docPDF.setTextColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                docPDF.text('STUDENT INFORMATION', 20, y);
                
                // Student info table
                y += 8;
                docPDF.setDrawColor(borderColor[0], borderColor[1], borderColor[2]);
                docPDF.setLineWidth(0.5);
                
                const studentData = [
                    ['Student Name', student.name || doc.studentName || doc.student?.name || 'N/A'],
                    ['Class & Section', `${student.class || doc.class || 'N/A'} - ${student.section || doc.section || 'N/A'}`],
                    ['Roll Number', student.rollNumber || doc.rollNumber || doc.student?.rollNumber || 'N/A'],
                    ['Payment Mode', pay.paymentMode || 'N/A'],
                    ['Transaction ID', pay.transactionId || 'N/A']
                ];
                
                docPDF.setFont('helvetica', 'normal');
                docPDF.setFontSize(10);
                docPDF.setTextColor(0, 0, 0);
                
                studentData.forEach((row, index) => {
                    const rowY = y + (index * 12);
                    if (index % 2 === 0) {
                        docPDF.setFillColor(255, 255, 255);
                    } else {
                        docPDF.setFillColor(backgroundColor[0], backgroundColor[1], backgroundColor[2]);
                    }
                    docPDF.rect(15, rowY - 2, 180, 12, 'F');
                    docPDF.rect(15, rowY - 2, 180, 12, 'S');
                    
                    docPDF.setFont('helvetica', 'bold');
                    docPDF.text(row[0], 20, rowY + 6);
                    docPDF.setFont('helvetica', 'normal');
                    docPDF.text(row[1], 100, rowY + 6);
                });

                // Payment Details Section
                y += 80;
                docPDF.setFont('helvetica', 'bold');
                docPDF.setFontSize(14);
                docPDF.setTextColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                docPDF.text('PAYMENT DETAILS', 20, y);

                // Amount paid highlight box
                y += 12;
                docPDF.setFillColor(successColor[0], successColor[1], successColor[2]);
                docPDF.roundedRect(15, y - 5, 180, 25, 3, 3, 'F');
                
                docPDF.setFont('helvetica', 'bold');
                docPDF.setFontSize(18);
                docPDF.setTextColor(255, 255, 255);
                docPDF.text('AMOUNT PAID', 35, y + 10);
                docPDF.setFontSize(24);
                const amountValue = Number(pay.amount) || 0;
                const amountPaidText = `Rs.${amountValue.toLocaleString('en-IN')}`;
                docPDF.setCharSpace(0); // Remove any extra character spacing
                docPDF.text(amountPaidText, 175, y+10,{ align: 'right' });

                // Balance information
                y += 35;
                // Use balance at payment time if available, otherwise use current balance
                let balanceAtPayment;
                let balanceLabel;
                if (pay.balanceAfterPayment !== undefined && pay.balanceAfterPayment !== null) {
                    balanceAtPayment = pay.balanceAfterPayment;
                    balanceLabel = 'Balance Due:';
                } else {
                    balanceAtPayment = doc.balance || 0;
                    balanceLabel = 'Current Balance Due:';
                }
                
                docPDF.setFillColor(backgroundColor[0], backgroundColor[1], backgroundColor[2]);
                docPDF.roundedRect(15, y - 5, 180, 20, 2, 2, 'F');
                
                docPDF.setFont('helvetica', 'bold');
                docPDF.setFontSize(12);
                docPDF.setTextColor(0, 0, 0);
                docPDF.text(balanceLabel, 35, y + 3);
                if (balanceAtPayment > 0) {
                    docPDF.setTextColor(220, 53, 69);
                } else {
                    docPDF.setTextColor(successColor[0], successColor[1], successColor[2]);
                }
                const balanceValue = Number(balanceAtPayment) || 0;
                const balanceText = `Rs.${balanceValue.toLocaleString('en-IN')}`;
                docPDF.setCharSpace(0); // Remove any extra character spacing
                docPDF.text(balanceText, 175, y+3,{ align: 'right' });
                
                if (balanceAtPayment <= 0) {
                    docPDF.setTextColor(successColor[0], successColor[1], successColor[2]);
                    docPDF.setCharSpace(0); // Remove any extra character spacing
                    docPDF.text('FULLY PAID', 35, y + 12);
                }

                // Status and Due Date
                y += 25;
                if (doc.dueDate) {
                    docPDF.setFont('helvetica', 'normal');
                    docPDF.setFontSize(10);
                    docPDF.setTextColor(secondaryColor[0], secondaryColor[1], secondaryColor[2]);
                    docPDF.text(`Fee Due Date: ${formatDateTime(doc.dueDate).split(' ')[0]}`, 20, y);
                }

                if (doc.status === 'overdue' && balanceAtPayment > 0) {
                    docPDF.setFillColor(220, 53, 69);
                    docPDF.roundedRect(15, y + 5, 180, 15, 2, 2, 'F');
                    docPDF.setFont('helvetica', 'bold');
                    docPDF.setFontSize(12);
                    docPDF.setTextColor(255, 255, 255);
                    docPDF.text('⚠ OVERDUE - Please clear remaining balance immediately', 20, y + 13);
                    y += 20;
                }

                // Remove watermark as requested

                // Footer
                const footerY = 265;
                docPDF.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                docPDF.rect(0, footerY, 210, 32, 'F');
                
                docPDF.setFont('helvetica', 'normal');
                docPDF.setFontSize(9);
                docPDF.setTextColor(255, 255, 255);
                docPDF.text('This is a computer-generated receipt and does not require a signature.', 15, footerY + 8);
                docPDF.text('For any queries, please contact the school office during working hours.', 15, footerY + 15);
                docPDF.text(`Generated on: ${formatDateTime(new Date())}`, 15, footerY + 22);
                
                // Thank you message - properly positioned
                docPDF.setFont('helvetica', 'bold');
                docPDF.setFontSize(10);
                docPDF.text('Thank you for your payment!', 195, footerY + 18, { align: 'right' });

                // Security features
                docPDF.setFont('helvetica', 'normal');
                docPDF.setFontSize(6);
                docPDF.setTextColor(200, 200, 200);
                const securityCode = `Security Code: ${pay.receipt?.number || 'TEMP'}-${Date.now().toString().slice(-6)}`;
                docPDF.text(securityCode, 190, footerY - 9, { align: 'right' });

                // Output
                if (openInNewWindow) {
                    docPDF.output('dataurlnewwindow');
                } else {
                    const filename = `St_Marys_Receipt_${pay.receipt?.number || Date.now()}_${student.name?.replace(/\s+/g, '_') || 'Student'}.pdf`;
                    docPDF.save(filename);
                }
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate receipt. Please try again.');
            }
        }

        function viewReceipt(doc, pay) {
            generateReceiptPDF(doc, pay, true);
        }

        function downloadReceipt(doc, pay) {
            generateReceiptPDF(doc, pay, false);
        }

        function renderPaymentHistory(paymentsDocs) {
            const tbody = document.getElementById('payment-history');
            if (!paymentsDocs || paymentsDocs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4"><em>No payments found.</em></td></tr>';
                return;
            }
            let rows = [];
            paymentsDocs.forEach(doc => {
                if (Array.isArray(doc.payments)) {
                    doc.payments.forEach((pay, idx) => {
                        // Include student data in the doc object
                        const docWithStudent = {
                            ...doc,
                            student: {
                                name: doc.studentName,
                                class: doc.class,
                                section: doc.section,
                                rollNumber: doc.rollNumber
                            }
                        };
                        rows.push(`
                            <tr>
                                <td>${pay.paymentDate ? new Date(pay.paymentDate).toLocaleDateString() : '-'}</td>
                                <td>${pay.paymentMode || '-'}</td>
                                <td>₹${pay.amount || '-'}</td>
                                <td>
                                    <div class="receipt-actions">
                                        <button class="view-receipt-link" onclick='viewReceipt(${JSON.stringify(docWithStudent)}, ${JSON.stringify(pay)})'>View Receipt</button>
                                        <button class="download-btn" onclick='downloadReceipt(${JSON.stringify(docWithStudent)}, ${JSON.stringify(pay)})'>Download Receipt</button>
                                    </div>
                                </td>
                            </tr>
                        `);
                    });
                }
            });
            tbody.innerHTML = rows.join('');
        }
        function closeReceiptModal() {
            document.getElementById('receipt-modal').style.display = 'none';
        }
        document.addEventListener('DOMContentLoaded', loadFeeDetails);
    </script>
</body>
</html>